<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 2 | General Form Elements</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta charset="utf-8" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <link href="http://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="myPrescriptions.css">
    <!--Datepicker srcs -->
    <link rel="stylesheet" href="css/datepicker.css" type="text/css" />
    <!--  <link rel="stylesheet" media="screen" type="text/css" href="css/layout.css" />-->
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/datepicker.js"></script>
    <script type="text/javascript" src="js/eye.js"></script>
    <script type="text/javascript" src="js/utils.js"></script>
    <script type="text/javascript" src="js/layout.js?ver=1.0.2"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">
        <header class="main-header">
            <!-- Logo -->
            <a href="entryPrescription.html" class="logo">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini"><b>dB</b></span>
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg"><!-- <img style="width:50px;" src="../../dist/img/user2-160x160.jpg" class="img-circle" alt="User Image"> --><b>dBotica</b></span>
            </a>
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <!-- User Account: style can be found in dropdown.less -->
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="dist/img/user2-160x160.jpg" class="user-image" alt="User Image">
                                <span class="hidden-xs" id="username1"></span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header">
                                    <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                                    <p>
                                        Doctor 1 - Cardiologist
                                        <small>Member since Feb 2016</small>
                                    </p>
                                </li>
                                <!-- Menu Body -->
                                <li class="user-body">
                                    <div class="col-xs-4 text-center">
                                        <a href="#">Followers</a>
                                    </div>
                                    <div class="col-xs-4 text-center">
                                        <a href="#">Health Tips</a>
                                    </div>
                                    <div class="col-xs-4 text-center">
                                        <a href="#">Friends</a>
                                    </div>
                                </li>
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="#" class="btn btn-default btn-flat">Profile</a>
                                    </div>
                                    <div class="pull-right">
                                        <a href="#" class="btn btn-default btn-flat">Sign out</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">
                <!-- Sidebar user panel (optional) -->
                <div class="user-panel">
                    <div class="pull-left image">
                        <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                    </div>
                    <div class="pull-left info">
                        <!--CHANGE here-->
                        <p id="username"></p>
                        <!-- Status -->
                        <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
                    </div>
                </div>
                <!-- Sidebar Menu -->
                <ul class="sidebar-menu">
                    <li class="header">HEADER</li>
                    <!-- Optionally, you can add icons to the links -->
                    <li class="active"><a href="entryPrescriptions.html"><i class="fa fa-link"></i> <span>Drug prescription</span></a></li>
                    <li><a href="#"><i class="fa fa-link"></i> <span>My Prescriptions</span></a></li>
                    <li><a href="myPatients.html"><i class="fa fa-link"></i> <span>My Patients</span></a></li>
                    <!-- <li class="active"><a href="../forms/PatientSearch.html"><i class="fa fa-link"></i> <span>Patient Search</span></a></li> -->
                    <li class="treeview">
                        <!--  <a href="../tables/data.html"><i class="fa fa-link"></i> <span>Drug database</span> <i class="fa fa-angle-left pull-right"></i></a> -->
                    </li>
                </ul>
                <!-- /.sidebar-menu -->
            </section>
            <!-- /.sidebar -->
        </aside>
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <h1>
            My Prescriptions
            <!-- <small>Preview</small> -->
          </h1>
            </section>
            <!-- Main content -->
            <section class="content">
                <div class="row">
                </div>
                <!--/.col (left) -->
                <div class="col-md-14">
                    <div class="box-header with-border">
                        <h3 class="box-title"></h3>
                    </div>
                    <!-- /.box-header -->
                </div>
                <!-- right column -->
                <div class="col-md-14">
                    <!-- general form elements disabled -->
                    <div class="box box-warning">
                        <div class="box-body">
                            <form role="form" id="search-form">
                                <div class="col-md-12 form-group"></div>
                                <div class="col-md-12 form-group">
                                    <div class="col-md-6 form-group">
                                        <label for="inputEmail3" class="col-sm-3 control-label">From</label>
                                        <div class="col-sm-6">
                                            <input type="date" class="form-control" id="myprescritions-start-date" placeholder="Start Date">
                                        </div>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="inputEmail3" class="col-sm-3 control-label">Patient Name</label>
                                        <div class="col-sm-6">
                                            <input type="text" class="form-control" id="myprescritions-search-name" placeholder="Name">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 form-group">
                                    <div class="col-md-6 form-group">
                                        <label for="inputEmail3" class="col-sm-3 control-label">To</label>
                                        <div class="col-sm-6">
                                            <input type="date" class="form-control" id="myprescritions-end-date" placeholder="End Date">
                                        </div>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="inputEmail3" class="col-sm-3 control-label">Patient Phone</label>
                                        <div class="col-sm-6">
                                            <input type="text" class="form-control" id="myprescritions-pateint-phone" placeholder="Phone Number">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 form-group">
                                    <button type="search" class="btn btn-primary pull-right" id="myprescriptions-search-button">Search</button>
                                </div>
                            </form>
                        </div>
                        <!-- /.box-body -->
                    </div>
                    <!-- /.box -->
                </div>
                <!--/.col (right) -->
                <!-- /.row -->
            </section>
            <!-- /.content -->
            <!-- Main content -->
            <section class="content">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box">
                            <div class="box-header">
                                <h3 class="box-title">Prescriptions</h3>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <input type='hidden' id='current_page' />
                                <input type='hidden' id='show_per_page' />
                                <div class="accordion col-md-11 form-group" id="prescription-list">
                                </div>
                                <div class="col-md-10">
                                    <div id='page_navigation'></div>
                                </div>
                                <!-- <table id="current-prescriptions" class="table table-bordered table-striped">
                    <thead>
                      <tr>
                        <th>BrandName</th>
                        <th>Price</th>
                        <th>Units</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                   <tfoot>
                      <tr>
                        <th>Rendering engine</th>
                        <th>Browser</th>
                        <th>Platform(s)</th>
                        <th>Engine version</th>
                        <th>CSS grade</th>
                      </tr>
                    </tfoot> 
                  </table-->
                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </section>
            <!-- Patient details content -->
        </div>
        <!-- /.content-wrapper -->
        <footer class="main-footer">
            <div class="pull-right hidden-xs">
                <b>Version</b> 1.0.0
            </div>
            <strong>Copyright &copy; 2015-2016 <a href="http://dbotica.com">Dbotica</a>.</strong> All rights reserved.
        </footer>
        <!-- Control Sidebar -->
    </div>
    <!-- ./wrapper -->
    <!-- jQuery 2.1.4 -->
    <script src="plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>
    <!-- Bootstrap 3.3.5 -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!--Cookie -->
    <script src="bootstrap/js/jquery.cookie.js"></script>
    <!-- FastClick -->
    <script src="plugins/fastclick/fastclick.min.js"></script>
    <!-- DataTables -->
    <script src="plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="plugins/datatables/dataTables.bootstrap.min.js"></script>
    <!-- AdminLTE App -->
    <script src="dist/js/app.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="dist/js/demo.js"></script>
    <!-- IndexedDB for local storage-->
    <script src="indexedDB/indexedDbotica.js"></script>
    <script type="text/javascript"></script>
    <script>

    function addRowToPrescriptionTable(prescriptionData) {
        console.log("prescription object is----", prescriptionData);

        var date = new Date(prescriptionData['creationTime']);
        var dateStr = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
        var content1 = '<div class="row"><div class="col-md-5"><h4>Patient Name  : <b>' + prescriptionData['patientName'] + '</b></h4></div><div class="col-md-5"><h4>Date of Prescription : <b>' + dateStr + '</b></h4></div></div>' + '<div><div class="box-body"><div class="col-md-12 form-group"><div class="col-md-3 form-group"><h5>Gender : </h5></div><div class="col-md-3 form-group" ><h5> <p placeholder="" id="patient-gender">' + prescriptionData['patientInfo']['gender'] + '</p></h5></div><div class="col-md-3 form-group"><h5>Age : </h5></div><div class="col-md-3 form-group"><h5><p  placeholder="" id="patient-age">' + prescriptionData['patientInfo']['age'] + '</p></h5></div><div class="col-md-3 form-group"><h5>Blood Pressure : </h5></div><div class="col-md-3 form-group" ><h5> <p placeholder="" id="patient-bp">' + prescriptionData['patientInfo']['bloodpressure'] + '</p></h5></div><div class="col-md-3 form-group"><h5>Temperature : </h5></div><div class="col-md-3 form-group" ><h5> <p placeholder="" id="patient-temperature">' + prescriptionData['prescription']['temperature'] + '</p></h5></div></div><div class="col-md-12 form-group"><div class="col-md-3 form-group"><h5>Clinical Impression : </h5></div><div class="col-md-3 form-group"><h5><p placeholder="" id="mypres-clinicalimpression">' + prescriptionData['prescription']['remarks'] + '</p></h5></div></div><table id="current-prescriptions" class="table table-bordered table-striped"><thead><tr><th>BrandName</th><th>Per Serving</th><th>Days</th><th>Quantity</th><th>Remarks</th></tr></thead><tbody>';
        for (var dd in prescriptionData['prescription']['drugDosage']) {
            var drug = prescriptionData['prescription']['drugDosage'][dd];
            content1 += '<tr><td>' + drug['drugId'] + '</td><td>' + drug['perServing'];
            if (parseInt(drug['noOfDays']) > 3) {
                content1 += ' ML';
            } else {
                content1 += ' MG';
            }
            content1 += '</td><td>' + drug['noOfDays'] + '</td><td>' + drug['quantity'] + '</td><td>' + drug['remarks'] + '</td></tr>';


        }

        content1 += '</tbody></table></div></div></div>';
        $("#prescription-list").append(content1);




    };



    $('#myprescriptions-search-button').click(function(e) {
        e.preventDefault();
        $("#prescription-list").empty();
        var fromDate = $("#myprescritions-start-date").val();
        var toDate = $("#myprescritions-end-date").val();
        var phoneNumber = $("#myprescritions-pateint-phone").val();
        console.log("from date ", fromDate);
        console.log("to date ", toDate);
        console.log("phone number ", phoneNumber);
        getPrescriptionsFromIndexedDB(fromDate, toDate, phoneNumber, addRowToPrescriptionTable);
        //getAllPrescriptionsFromIndexedDB(addRowToPrescriptionTable);

    });

    function getAllPrescriptions() {
        getAllPrescriptionsFromIndexedDB(addRowToPrescriptionTable, "#prescription-list");
    }
    $(document).ready(function() {
        //CHANGE here
        openDb(getAllPrescriptions);


        console.log("myPrescriptions opened");
        $('#username').text(localStorage.getItem('firstName'));
        $('#username1').text(localStorage.getItem('firstName'));
        var doctorId = localStorage.getItem('doctorId');
        /* $.ajax({ 
                   type: "GET",
                   url: "http://localhost:8081/dbotica-spring/doctor/myPrescriptions",
                   data: {'doctorId': doctorId, 'start':'0','limit':'10'},
                    success: function(response){ 
                     var data1 = $.parseJSON(response.response);
                    
                   
                   for (var s in data1)
                   {
                     console.log(data1[0]);

                     var date = new Date(data1[s]['prescription']['creationTime']);
                     var dateStr = date.getDate()+"/"+(date.getMonth()+1)+"/"+date.getFullYear();
                     var content1 ='<div class="box box-default collapsed-box">'+'<div class="box-header with-border">'+'<h6 class="box-title">'+' <span class="badge bg-light-blue">'+'<h5>'+'Transaction id </h5>'+'</span>'+'&nbsp&nbsp;' +data1[s]['prescription']['id'] +'</h6>'+'<h3 class="box-title">'+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+'<span class="badge bg-light-blue">'+'<h5>Date of Prescription</h5> '+'</span>'+'&nbsp&nbsp;'+dateStr+'</h3>'+'<h3 class="box-title">'+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+'<span class="badge bg-light-blue">'+'<h5>Patient Id</h5>'+'</span>'+'&nbsp&nbsp;'+data1[s]['prescription']['id']+'</h3>'+
                       '<div class="box-tools pull-right">'+' <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button> </div> </div>'+
                       '<div class="box-body"><div class="col-md-12 form-group"><div class="col-md-3 form-group"><h4>Gender : </h4></div><div class="col-md-3 form-group" ><h4> <p placeholder="" id="patient-gender">'+data1[s]['prescription']['gender']+'</p></h4></div><div class="col-md-3 form-group"><h4>Age : </h4></div><div class="col-md-3 form-group"><h4><p  placeholder="" id="patient-age">'+data1[s]['prescription']['age']+'</p></h4></div><div class="col-md-3 form-group"><h4>Blood Pressure : </h4></div><div class="col-md-3 form-group" ><h4> <p placeholder="" id="patient-bp">'+data1[s]['prescription']['bloodpressure']+'</p></h4></div><div class="col-md-3 form-group"><h4>Temperature : </h4></div><div class="col-md-3 form-group" ><h4> <p placeholder="" id="patient-temperature">'+data1[s]['prescription']['temperature']+'</p></h4></div></div><div class="col-md-12 form-group"><div class="col-md-3 form-group"><h4>Clinical Impression : </h4></div><div class="col-md-3 form-group"><h4><p placeholder="" id="mypres-clinicalimpression">'+data1[s]['prescription']['remarks']+'</p></h4></div></div><table id="current-prescriptions" class="table table-bordered table-striped"><thead><tr><th>BrandName</th><th>Per Serving</th><th>Days</th><th>Quantity</th><th>Remarks</th></tr></thead><tbody>';
                    
                     for(var dd in data1[s]['prescription']['drugDosage']){
                       var drug = data1[s]['prescription']['drugDosage'][dd];
                       content1 += '<tr><td>'+drug['drugId']+'</td><td>'+drug['perServing'];
                       if(parseInt(drug['noOfDays']) > 3){
                         content1 += ' ML';
                       } else {
                         content1 += ' MG';
                       }
                       content1 += '</td><td>'+drug['noOfDays']+'</td><td>'+drug['quantity']+'</td><td>'+drug['remarks']+'</td></tr>';
                     }

                     content1 += '</tbody></table></div></div>';

                     $("#content").append(content1);

                   }
                   paginationStart();
                               
                   } 

                 }); */






        //paginationStart();

    });

    function paginationStart() {

        console.log("hi");

        //how much items per page to show  
        var show_per_page = 5;
        //getting the amount of elements inside content div  
        var number_of_items = $('#prescription-list').children().size();
        console.log(number_of_items + ': number_of_items');
        //calculate the number of pages we are going to have  
        var number_of_pages = Math.ceil(number_of_items / show_per_page);

        //set the value of our hidden input fields  
        $('#current_page').val(0);
        $('#show_per_page').val(show_per_page);

        //now when we got all we need for the navigation let's make it '  

        /* 
        what are we going to have in the navigation? 
            - link to previous page 
            - links to specific pages 
            - link to next page 
        */
        var navigation_html = '<a class="previous_link" href="javascript:previous();">Prev </a>';
        var current_link = 0;
        while (number_of_pages > current_link) {
            navigation_html += '<a class="page_link" href="javascript:go_to_page(' + current_link + ')" longdesc="' + current_link + '">' + (current_link + 1) + '</a>';
            current_link++;
        }
        navigation_html += '<a class="next_link" href="javascript:next();"> Next</a>';

        $('#page_navigation').html(navigation_html);

        //add active_page class to the first page link  
        $('#page_navigation .page_link:first').addClass('active_page');

        //hide all the elements inside content div  
        $('#prescription-list').children().css('display', 'none');

        //and show the first n (show_per_page) elements  
        $('#prescription-list').children().slice(0, show_per_page).css('display', 'block');


    }

    function previous() {

        new_page = parseInt($('#current_page').val()) - 1;
        //if there is an item before the current active link run the function  
        if ($('.active_page').prev('.page_link').length == true) {
            go_to_page(new_page);
        }

    }

    function next() {
        new_page = parseInt($('#current_page').val()) + 1;
        //if there is an item after the current active link run the function 
        console.log('new_page :' + new_page);
        if ($('.active_page').next('.page_link').length == true) {
            go_to_page(new_page);
        }

    }

    function go_to_page(page_num) {
        //get the number of items shown per page  
        var show_per_page = parseInt($('#show_per_page').val());

        //get the element number where to start the slice from  
        start_from = page_num * show_per_page;

        //get the element number where to end the slice  
        end_on = start_from + show_per_page;

        //hide all children elements of content div, get specific items and show them  
        $('#prescription-list').children().css('display', 'none').slice(start_from, end_on).css('display', 'block');

        /*get the page link that has longdesc attribute of the current page and add active_page class to it 
        and remove that class from previously active page link*/
        $('.page_link[longdesc=' + page_num + ']').addClass('active_page').siblings('.active_page').removeClass('active_page');

        //update the current page input field  
        $('#current_page').val(page_num);
    }
    </script>
</body>

</html>
