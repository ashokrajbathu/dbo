<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 2 | Log in</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link class="cssdeck" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" class="cssdeck">
    <link href="css/jquery-ui.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="fonts/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="plugins/iCheck/square/blue.css">
    <link rel="stylesheet" type="text/css" href="login.css">

    <script src="plugins/sweetalert/dist/sweetalert.min.js"></script> 
    <link rel="stylesheet" type="text/css" href="plugins/sweetalert/dist/sweetalert.css">

    <style type="text/css">
    .nav-tabs>li {
        float: left;
        width: 50%;
    }
    
    .tab-content {
        margin-left: -105px;
    }
    
    .modal-body {
        padding: 100px 100px 100px 160px;
    }
    </style>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <div class="" id="loginModal">
        <div class="modal-header" style="background-color:#3c8dbc;height:50px;">
            <h2 style="color:white">dbotica</h2>
        </div>
        <div class="modal-body" style="width:30%;margin-left:25%;">
            <div class="well" style="padding:8px;width:91%;">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#login" data-toggle="tab">Login</a></li>
                    <li><a href="#create" data-toggle="tab">Sign Up</a></li>
                </ul>
                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane active in" id="login">
                        <form class="form-horizontal">
                            <fieldset>
                                <div class="control-group">
                                    <!-- Username -->
                                    <label class="control-label" for="username">Email Id</label>
                                    <div class="controls">
                                        <input type="text" id="emailId" name="username" placeholder="" class="input-xlarge">
                                    </div>
                                </div>
                                <div class="control-group">
                                    <!-- Password-->
                                    <label class="control-label" for="password">Password</label>
                                    <div class="controls">
                                        <input type="password" id="password" name="password" placeholder="" class="input-xlarge">
                                    </div>
                                </div>
                                <div class="control-group">
                                    <!-- Button -->
                                    <div class="controls">
                                        <span>
                                        <div style="margin-left:100px;" id="login-submit" class="btn btn-success">Login</div>
                                        </span>
                                    </div>
                                </div>
                                <a style="margin-left:32%;" href="#">Forgot Password?</a>
                            </fieldset>
                        </form>
                    </div>
                    <div class="tab-pane fade" id="create" style="margin-left:30%;">
                        <form id="tab">
                            <label>Name</label>
                            <input type="text" id="exampleInputName" value="" class="input-xlarge">
                            <label>Phone</label>
                            <input type="text" id="exampleInputPhone" value="" class="input-xlarge">
                            <label>Email</label>
                            <input type="text" id="exampleInputEmail" value="" class="input-xlarge">
                            <div>
                                <div id="signUpSubmitBtn" class="btn btn-primary">Sign Up</div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="dialog-1" title="You are successfully signed up.....">dbotica team will contact you shortly!!</div>
    <!-- /.login-box -->
    <!-- jQuery 2.1.4 -->
    <script class="cssdeck" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script class="cssdeck" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    <!-- iCheck -->
    <script src="plugins/iCheck/icheck.min.js"></script>
    <script>
    $(document).ready(function() {
        $("#dialog-1").dialog({
            autoOpen: false,
        });


        $(function() {
            $('input').iCheck({
                checkboxClass: 'icheckbox_square-blue',
                radioClass: 'iradio_square-blue',
                increaseArea: '20%' // optional
            });

            if (localStorage.getItem("isLoggedIn") == "true") {
                window.location.replace("entryPrescriptions.html");
            }
        });

        $('#login-submit').click(function(e) {
            var emailId = $('#emailId').val();
            var password = $('#password').val();
            console.log("emailId: " + emailId + ", password: " + password);
            // console.log(localStorage.getItem("password"));
            $.ajax({
                type: "POST",
                url: "http://localhost:8081/dbotica-spring/doctor/login",
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.setRequestHeader("Accept", "application/json");
                },
                xhrFields: {
                    withCredentials: true
                },
                async: false,
                data: JSON.stringify({
                    'emailId': emailId,
                    'password': password
                }),
                success: function(response) {
                    var errorCode = response.errorCode;
                    if (!!errorCode) {
                        switch (errorCode) {
                            case "BAD_CREDENTIALS" :
                            swal({
                                title: "Error",
                                text: "Incorrect email or password.",
                                type: "error",
                                confirmButtonText: "OK" });
                                break;
                            case "USER_ALREADY_LOGGED_IN" :
                                localStorage.setItem("isLoggedIn", true);
                                window.location.replace("entryPrescriptions.html");
                                break;
                        }
                    }

                    var data = $.parseJSON(response.response);
                    console.log(data);
                    localStorage.setItem('doctorPojo', response.response);
                    localStorage.setItem("isLoggedIn", true);
                    localStorage.setItem("firstName", data['firstName']);
                    localStorage.setItem("doctorId", data['id']);

                    localStorage.setItem("doctorSpeciality", data['speciality']);
                    localStorage.setItem("doctorOrganization", data['organization']);
                    localStorage.setItem("doctorQualification", data['qualification']);
                    localStorage.setItem("doctorPublicPhoneNumber", data['publicPhoneNumber']);
                    localStorage.setItem("doctorOfficeAddress", data['officeAddress']);
                    console.log(localStorage.getItem("firstName"));
                    window.location.replace("entryPrescriptions.html");
                }
            });
        });
        $("#signUpSubmitBtn").click(function() {
            var name = $("#exampleInputName").val();
            var email = $("#exampleInputEmail").val();
            var phone = $("#exampleInputPhone").val();
            if (name === "" || (email === "" && phone === "")) {
                swal({
                    title: "Error",
                    text: "Kindly enter the details",
                    type: "error",
                    confirmButtonText: "OK" });
            } else {
                $.ajax({
                    type: 'POST',
                    url: 'http://localhost:8081/dbotica-spring/doctor/referDoctor',
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader("Content-Type", "application/json");
                        xhr.setRequestHeader("Accept", "application/json");
                    },
                    async: false,
                    
                    data: JSON.stringify({
                        'doctorName': name,
                        'emailId': email,
                        'phoneNumber': phone

                    }),
                    success: function(response) {
                        swal({
                            title: "Success",
                            text: "Thank You!! dBotica team will call you shortly",
                            type: "success",
                            confirmButtonText: "OK" });

                    },
                    error: function(request, status, error) {
                        swal({
                            title: "Error",
                            text: "Error receiving the details. Kindly try after some time",
                            type: "error",
                            confirmButtonText: "OK" });
                    }

                });
            }
        });
    });
    </script>
</body>

</html>
